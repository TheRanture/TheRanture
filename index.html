<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HBM Archive</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <link href="https://fonts.googleapis.com/css2?family=Lora&display=swap" rel="stylesheet" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      scroll-behavior: smooth;
      font-family: 'Lora', serif;
      background-color: var(--article-bg);
      color: var(--text-color);
    }

    :root {
      --article-bg: #f9f9f6;
      --text-color: #222;
      --toolbar-bg: #e0e0dc;
      --toolbar-border: #ccc;
    }

    body.dark-mode {
      --article-bg: #121212;
      --text-color: #f0f0f0;
      --toolbar-bg: #1f1f1f;
      --toolbar-border: #333;
    }

    header {
      background: black;
      color: white;
      padding: 0.5em 1em;
      font-size: 1.5em;
      text-align: center;
      font-family: 'Lora', serif;
    }

    #header-toolbar-wrapper {
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 1000;
      background: var(--toolbar-bg);
      border-bottom: 1px solid var(--toolbar-border);
    }

    #search-container {
      padding: 0.5em;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      gap: 0.5em;
    }

    #search-bar {
      display: none;
      padding: 0.4em;
      font-size: 1em;
      border: 1px solid #aaa;
      border-radius: 4px;
    }

    #search-funny {
      width: 100%;
      text-align: center;
      color: #888;
      font-style: italic;
      padding-top: 0.5em;
    }

    #clear-search {
      display: none;
      background: none;
      border: none;
      font-size: 1.2em;
      cursor: pointer;
      color: #666;
    }

    nav#toolbar {
      display: flex;
      justify-content: center;
      gap: 1em;
      padding: 0.5em;
      background-color: var(--toolbar-bg);
      border-top: 1px solid var(--toolbar-border);
    }

    .toolbar-btn {
      background: none;
      border: none;
      padding: 0.4em 1em;
      cursor: pointer;
      font-size: 1em;
      border-radius: 6px;
    }

    .toolbar-btn.active {
      background: #ccc;
    }

    .articles-container {
      margin-top: 130px; /* make room for header and toolbar */
      padding: 1em;
      display: flex;
      flex-direction: column;
      gap: 1em;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }

    .article-preview {
      border: 1px solid #ddd;
      padding: 1em;
      border-radius: 6px;
      cursor: pointer;
      background-color: #fff;
      transition: background-color 0.2s;
    }

    .article-preview:hover {
      background-color: #f0f0f0;
    }

    .preview-image {
      max-width: 100%;
      height: auto;
      border-radius: 4px;
      margin-bottom: 0.5em;
    }

    .content-page {
      padding: 1em;
      line-height: 1.6;
      font-size: 1.1em;
      max-width: 900px;
      margin: 120px auto 2em auto;
    }

    .content-page h2 {
      margin-top: 0;
    }

    #footnote {
      text-align: center;
      padding: 1em;
      font-size: 0.9em;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    #mode-toggle {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 1500;
      padding: 0.4em 0.8em;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background-color: #444;
      color: white;
    }

    #mode-toggle:hover {
      background-color: #666;
    }

    .search-suggestion {
      cursor: pointer;
      color: #0088cc;
      font-weight: bold;
      text-align: center;
    }

    body.dark-mode .article-preview {
      background-color: #1e1e1e;
      border-color: #444;
    }

    body.dark-mode .article-preview:hover {
      background-color: #2a2a2a;
    }

    body.dark-mode #search-funny {
      color: #bbb;
    }

    body.dark-mode #clear-search {
      color: #ccc;
    }

    body.dark-mode .content-page {
      background-color: transparent;
    }

    a {
      color: #0066cc;
    }

    body.dark-mode a {
      color: #4ea3ff;
    }

    /* Make room at bottom so footnote doesn't cover */
    body::after {
      content: '';
      display: block;
      height: 50px;
    }
  </style>
</head>
<body>
  <!-- Mode toggle -->
  <button id="mode-toggle" aria-label="Toggle Mode">Mode: Light</button>

  <!-- Header and Toolbar fixed wrapper -->
  <div id="header-toolbar-wrapper">
    <header>
      <h1>HBM Archive</h1>
    </header>

    <div id="search-container">
      <button id="search-toggle" aria-label="Toggle Search" title="Toggle search bar">
        <svg xmlns="http://www.w3.org/2000/svg" height="22" viewBox="0 0 24 24" width="22" fill="currentColor" aria-hidden="true" focusable="false">
          <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zM10 14a4 4 0 110-8 4 4 0 010 8z"/>
        </svg>
      </button>
      <input type="text" id="search-bar" placeholder="Search..." aria-label="Search" autocomplete="off" />
      <button id="clear-search" title="Clear" aria-label="Clear Search">Ã—</button>
      <div id="search-funny" aria-live="polite"></div>
    </div>

    <nav id="toolbar" role="navigation" aria-label="Primary site navigation">
      <button class="toolbar-btn active" data-page="articles">Articles</button>
      <button class="toolbar-btn" data-page="shorticles">Shorticles</button>
      <button class="toolbar-btn" data-page="books">Books</button>
      <button class="toolbar-btn" data-page="about">About</button>
      <button class="toolbar-btn" data-page="tos">ToS</button>
    </nav>
  </div>

  <!-- Article Previews -->
  <div class="articles-container" id="articles-container">
    <div class="article-preview" onclick="loadArticle('ai-rights.html', this)">
      <img src="myfolder/Banner.png" alt="AI Rights Banner" class="preview-image" />
      <h3>AI Consciousness and Rights</h3>
      <p>An exploration of AI awareness.</p>
    </div>
  </div>

  <!-- Full article content container -->
  <div id="article-full-content" style="display:none; max-width: 900px; margin: 1em auto;"></div>

  <!-- Main content for toolbar pages -->
  <main id="main-content" tabindex="0" aria-live="polite"></main>

  <!-- Footnote -->
  <div id="footnote">Made possible by bad choices and good intentions.</div>

  <!-- Back to top button -->
  <button id="back-to-top" aria-label="Back to top" title="Back to top" 
    style="
      display:none;
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 36px;
      height: 36px;
      background: rgba(0, 0, 0, 0.3);
      border: none;
      border-radius: 50%;
      color: white;
      font-size: 20px;
      cursor: pointer;
      z-index: 15000;
      box-shadow: 0 1px 4px rgba(0,0,0,0.5);
      user-select: none;
      transition: background-color 0.3s ease;
    "
    onmouseenter="this.style.background='rgba(0,0,0,0.6)'" 
    onmouseleave="this.style.background='rgba(0,0,0,0.3)'"
  >â†‘</button>
<script>
  // Build searchable index from article previews
  const searchableArticles = Array.from(document.querySelectorAll('.article-preview')).map(preview => {
    const titleElem = preview.querySelector('h3');
    const snippetElem = preview.querySelector('p');
    const fileMatch = preview.getAttribute('onclick')?.match(/loadArticle\(['"]([^'"]+)['"]/);
    return {
      title: titleElem?.textContent.trim() || '',
      snippet: snippetElem?.textContent.trim() || '',
      file: fileMatch ? fileMatch[1] : '',
      keywords: (titleElem?.textContent.toLowerCase().split(/\s+/) || [])
    };
  });

  // Handle browser back/forward buttons
  window.addEventListener('popstate', (event) => {
    if (event.state && event.state.page) {
      if (event.state.page === 'article' && event.state.file) {
        loadArticle(event.state.file, false);
      } else if (event.state.page === 'section' && event.state.section) {
        loadSection(event.state.section, false);
      }
    } else {
      document.getElementById('article-full-content').style.display = 'none';
      document.getElementById('articles-container').style.display = 'block';
      document.getElementById('main-content').style.display = 'block';
      document.querySelectorAll('.toolbar-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelector('.toolbar-btn[data-page="articles"]').classList.add('active');
      document.getElementById('main-content').innerHTML = '';
    }
  });

  function loadArticle(filename, pushHistory = true) {
    fetch(filename)
      .then(response => response.text())
      .then(html => {
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        const articleContent = doc.querySelector('.ai-rights-body');

        if (articleContent) {
          document.getElementById('articles-container').style.display = 'none';
          document.getElementById('main-content').style.display = 'none';
          const container = document.getElementById('article-full-content');
          document.getElementById('search-funny').style.display = 'none';
          container.innerHTML = `<div class="content-page">${articleContent.innerHTML}</div>`;
          container.style.display = 'block';
          container.scrollIntoView({ behavior: 'smooth' });
          document.querySelectorAll('.toolbar-btn').forEach(btn => btn.classList.remove('active'));
          if (pushHistory) {
            history.pushState({ page: 'article', file: filename }, '', `#${filename}`);
          }
          localStorage.setItem('lastView', JSON.stringify({ type: 'article', file: filename }));
        } else {
          alert('Article content not found.');
        }
      })
      .catch(err => alert('Failed to load article: ' + err));
  }

  function loadSection(page, pushHistory = true) {
    document.querySelectorAll('.toolbar-btn').forEach(btn => {
      btn.classList.toggle('active', btn.getAttribute('data-page') === page);
    });

    document.getElementById('article-full-content').style.display = 'none';
    document.getElementById('articles-container').style.display = (page === 'articles') ? 'block' : 'none';
    const mainContent = document.getElementById('main-content');
    mainContent.style.display = 'block';

    if (page === 'articles') {
      mainContent.innerHTML = '';
    } else if (page === 'shorticles') {
      mainContent.innerHTML = `<div class="content-page"><h2>Shorticles</h2><p>Shorticles content goes here...</p></div>`;
    } else if (page === 'books') {
      mainContent.innerHTML = `<div class="content-page"><h2>Books</h2><p>Books content goes here...</p></div>`;
    } else if (page === 'about') {
      mainContent.innerHTML = `<div class="content-page"><h2>About</h2><p>This website is written by <strong>Karlos Hayden</strong>, a self proclaimed synchromancer.</p></div>`;
    } else if (page === 'tos') {
      mainContent.innerHTML = `<div class="content-page"><h2>Legal Disclaimer & Terms of Use</h2><p>...</p></div>`;
    } else {
      mainContent.innerHTML = `<p>Unknown page: ${page}</p>`;
    }

    if (pushHistory) {
      history.pushState({ page: 'section', section: page }, '', `#${page}`);
    }

    localStorage.setItem('lastView', JSON.stringify({ type: 'section', page }));
  }

  document.addEventListener('DOMContentLoaded', () => {
    const hash = window.location.hash.substring(1);
    let handled = false;

    if (hash) {
      if (hash.endsWith('.html')) {
        loadArticle(hash, false);
        handled = true;
      } else {
        loadSection(hash, false);
        handled = true;
      }
    }

    if (!handled) {
      const saved = localStorage.getItem('lastView');
      if (saved) {
        const view = JSON.parse(saved);
        if (view.type === 'article' && view.file) {
          loadArticle(view.file, false);
        } else if (view.type === 'section' && view.page) {
          loadSection(view.page, false);
        } else {
          loadSection('articles', false);
        }
      } else {
        loadSection('articles', false);
      }
    }

    document.querySelectorAll('.toolbar-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const page = btn.getAttribute('data-page');
        loadSection(page);
      });
    });

    document.querySelectorAll('.article-preview').forEach(preview => {
      preview.addEventListener('click', (e) => {
        e.preventDefault();
        const file = preview.getAttribute('data-file');
        if (file) {
          loadArticle(file);
        }
      });
    });
  });

  const modeToggle = document.getElementById('mode-toggle');
  const backToTopBtn = document.getElementById('back-to-top');

  window.addEventListener('scroll', () => {
    if (window.scrollY > 300) {
      backToTopBtn.style.display = 'block';
    } else {
      backToTopBtn.style.display = 'none';
    }
  });

  backToTopBtn.addEventListener('click', () => {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  window.addEventListener('keydown', (e) => {
    if (e.key === 'Home') {
      e.preventDefault();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  });

  modeToggle.addEventListener('click', () => {
    document.body.classList.toggle('dark-mode');
    const isDark = document.body.classList.contains('dark-mode');
    modeToggle.textContent = 'Mode: ' + (isDark ? 'Dark' : 'Light');
  });

  document.addEventListener('click', (event) => {
    const searchContainer = document.getElementById('search-container');
    const searchBar = document.getElementById('search-bar');
    const clearBtn = document.getElementById('clear-search');
    const funnyBox = document.getElementById('search-funny');

    if (!searchContainer.contains(event.target)) {
      searchBar.style.display = 'none';
      clearBtn.style.display = 'none';
      funnyBox.style.display = 'none';
    }
  });

  const searchToggle = document.getElementById('search-toggle');
  const searchBar = document.getElementById('search-bar');
  const funnyBox = document.getElementById('search-funny');
  const clearSearch = document.getElementById('clear-search');

  const funnyResponses = {
    "aliens": "ðŸ‘½ Try Paris.",
    "password": "ðŸ” Nice try. The password is not 'password'.",
    "secret": "ðŸ¤« If I told you, it wouldnâ€™t be a secret.",
    "ninja": "Ninjas donâ€™t search. They just know.",
    "pyramids": "ðŸ”º Youâ€™re not cleared for that level.",
    "saturn worship": "ðŸª Rings and things they wonâ€™t teach in school.",
    "ghost": "ðŸ‘» Boo! No ghosts, just results.",
    "bigfoot": "ðŸ¦¶ Found. But he blocked us.",
    "project monarch": "ðŸ¦‹ A butterfly flaps its wings. Someone forgets their password.",
    "psychic": "ðŸ”® We knew you'd search this.",
    "ai takeover": "ðŸ¤– Donâ€™t worry, weâ€™re still letting you type.",
    "nanobots": "âš™ï¸ Technology so small itâ€™s already in your cereal.",
    "clones": "ðŸ§¬ If they blink out of sync, run.",
    "dimensions": "ðŸŒ€ You're in the third. For now.",
    "antarctica": "â„ï¸ Just ice. And totally no secrets. Nope.",
    "smart dust": "ðŸŒ«ï¸ Don't inhale the future.",
    "truth serum": "ðŸ’‰ Works best when you're already guilty.",
    "wikipedia": "ðŸ“– Edited 13 times... today.",
    "hidden messages": "ðŸ§¾ Rotate 180Â°, hold to the light, squint.",
    "kangaroo": "ðŸ¦˜ Jumping to conclusions? Not here.",
    "free energy": "âš¡ Sounds free until the bill arrives.",
    "hack": "ðŸ’» Try turning it off and whispering to it.",
    "vatican secrets": "ðŸ“œ You must be at least Level 9 to access this.",
    "black hole": "ðŸ•³ï¸ You're already falling in.",
    "secret bases": "ðŸ—ºï¸ Hidden in plain sight. Like your car keys.",
    "deep state": "ðŸ›ï¸ Deeper than your browser history. And twice as weird.",
    "paperclip": "ðŸ“Ž Holding it all together for you.",
    "mind control": "ðŸŽ§ Please enjoy this relaxing frequency.",
    "immortality": "ðŸ§¬ Ask again in 3,000 years.",
    "fbi": "ðŸ§  We can neither confirm nor deny your search.",
    "cia": "ðŸ•µï¸â€â™‚ï¸ Your queries are being monitored... kidding!",
    "nsa": "ðŸ‘ï¸ You've been watched. For science.",
    "conspiracy": "ðŸ›¸ The truth is out there, but we're keeping it here.",
    "secret society": "ðŸ¤« Not for your eyes. Or maybe it is.",
    "flat earth": "ðŸŒ Flat? Thatâ€™s just the horizon of imagination.",
    "moon landing": "ðŸš€ One small step for man, one giant leap for memes."
  };

  searchToggle.addEventListener('click', (event) => {
    event.stopPropagation();
    if (searchBar.style.display === 'inline-block') {
      searchBar.style.display = 'none';
      funnyBox.style.display = 'none';
      clearSearch.style.display = 'none';
    } else {
      searchBar.style.display = 'inline-block';
      searchBar.focus();
      funnyBox.style.display = 'block';

      if (searchBar.value.trim().length) {
        clearSearch.style.display = 'inline';
      }
    }
  });

  searchBar.addEventListener('input', () => {
    const val = searchBar.value.trim().toLowerCase();
    clearSearch.style.display = val.length ? 'inline' : 'none';

    if (funnyResponses[val]) {
      funnyBox.textContent = funnyResponses[val];
      return;
    }

    const match = searchableArticles.find(article =>
      article.title.toLowerCase().includes(val) ||
      article.keywords.some(keyword => keyword.startsWith(val))
    );

    if (match && val.length > 0) {
      funnyBox.innerHTML = `
        <div class="search-suggestion" onclick="loadArticle('${match.file}'); document.getElementById('search-funny').style.display='none';">
          ${match.title}
        </div>
      `;
    } else if (val.length > 0) {
      funnyBox.textContent = 'Searching... No results found.';
    } else {
      funnyBox.textContent = '';
    }
  });

  clearSearch.addEventListener('click', () => {
    searchBar.value = '';
    funnyBox.textContent = '';
    clearSearch.style.display = 'none';
    searchBar.focus();
  });

  // Footnote visibility on scroll near bottom
  const footnote = document.getElementById('footnote');
  window.addEventListener('scroll', () => {
    const scrollBottom = window.innerHeight + window.scrollY;
    const docHeight = document.documentElement.offsetHeight;
    if (docHeight - scrollBottom < 200) {
      footnote.style.opacity = '1';
      footnote.style.pointerEvents = 'auto';
    } else {
      footnote.style.opacity = '0';
      footnote.style.pointerEvents = 'none';
    }
  });

  // Konami code
  const konamiCode = [38,38,40,40,37,39,37,39,66,65];
  let konamiPosition = 0;
  const popupId = 'konami-popup';

  function showKonamiPopup() {
    if (document.getElementById(popupId)) return;
    const popup = document.createElement('div');
    popup.id = popupId;
    popup.textContent = 'They are watching!';
    popup.style.position = 'fixed';
    popup.style.top = '50%';
    popup.style.left = '50%';
    popup.style.transform = 'translate(-50%, -50%)';
    popup.style.backgroundColor = '#cc0000';
    popup.style.color = '#fff';
    popup.style.fontSize = '2rem';
    popup.style.padding = '30px 50px';
    popup.style.borderRadius = '8px';
    popup.style.zIndex = '15000';
    popup.style.fontWeight = 'bold';
    popup.style.fontFamily = 'monospace';
    popup.style.textAlign = 'center';
    popup.style.userSelect = 'none';
    popup.style.boxShadow = '0 0 15px #ff0000';
    document.body.appendChild(popup);
    setTimeout(() => {
      if (popup.parentNode) popup.parentNode.removeChild(popup);
    }, 4000);
  }

  window.addEventListener('keydown', (e) => {
    if (e.keyCode === konamiCode[konamiPosition]) {
      konamiPosition++;
      if (konamiPosition === konamiCode.length) {
        konamiPosition = 0;
        showKonamiPopup();
      }
    } else {
      konamiPosition = 0;
    }
  });
</script>
</html>
